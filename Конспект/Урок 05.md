# Урок 05 — Клавиатуры и хендлеры (PersonalShop)

##  Цели урока
- Понять, как создавать клавиатуры для бота (Reply)
- Научиться писать хендлеры для кнопок и команд
- Повторить использование load_dotenv и конструкции if __name__ == "__main__"
- Понять организацию проекта Telegram-бота

---

## 1. Типы клавиатур

| Вид клавиатуры | Описание | Пример применения |
|----------------|-----------|------------------|
| ReplyKeyboardMarkup | Показывается вместо поля ввода текста. Кнопки отправляют текст как сообщение. | Главное меню, навигация |
| InlineKeyboardMarkup | Отображается под сообщением, кнопки могут содержать callback_data или ссылки. | Кнопки "Подробнее", "Назад", "Удалить" |
| KeyboardBuilder (Reply/Inline) | Динамически строит клавиатуры из списков или данных. | Генерация меню на основе базы данных, фильтров, циклов |

Совет: стартовое меню → ReplyKeyboardMarkup, действия внутри сообщений → InlineKeyboardMarkup, динамические кнопки → Builder

---

## 2. Пример клавиатуры (keyboards/reply.py)

```python
from aiogram.types import KeyboardButton
from aiogram.utils.keyboard import ReplyKeyboardMarkup

def start_keyboard():
    return ReplyKeyboardMarkup(
        keyboard=[[KeyboardButton(text="ваша кнопка")]],
        resize_keyboard=True
    )
```

---

## 3. Пример хендлера (handlers/start.py)

```python
from aiogram import Router, F
from aiogram.types import Message, FSInputFile
from aiogram.filters import CommandStart
from keyboards.reply import start_keyboard

router = Router()

@router.message(CommandStart())
async def command_start(message: Message):
    photo = FSInputFile("media/ваша картинка.jpg")
    await message.answer_photo(
        photo=photo,
        caption=f"Добрый день, <i>{message.from_user.full_name}</i>\nНажмите кнопку ниже, чтобы начать",
        parse_mode='HTML',
        reply_markup=start_keyboard()
    )

@router.message(F.text == "ваша кнопка")
async def handle_start_button(message: Message):
    await handle_start(message)

async def handle_start(message: Message):
    await register_user(message)
```

Плюсы: код структурирован, асинхронность, гибкость клавиатур.  
Возможные улучшения: хранить названия кнопок в constants.py, использовать понятный текст кнопок, проверить register_user.

---

## 4. load_dotenv

```python
from dotenv import load_dotenv
import os

load_dotenv()
BOT_TOKEN = os.getenv("TOKEN")
```

- Загружает переменные из `.env`, безопасно хранит токены.  

---

## 5. if __name__ == "__main__"

```python
if __name__ == "__main__":
    main()
```

- Проверяет, запущен ли файл напрямую.  
- Если импортируется как модуль, код не выполняется.

---

## 6. Структура проекта PersonalShop

```
bot_utils/
database/
media/
handlers/
keyboards/
.gitignore
requirements.txt
main.py
config.py
.env
venv/
```

- handlers/ — обработчики команд и кнопок  
- keyboards/ — клавиатуры  
- media/ — изображения и файлы  
- database/ — модели и работа с БД  
- bot_utils/ — вспомогательные функции  
- main.py — точка входа  
- venv/ — виртуальное окружение  
- config - считывает данные из файла .env безопасно передавая их

---

## Итог
- Изучили клавиатуры и хендлеры, асинхронные функции.  
- Поняли работу load_dotenv и конструкции if __name__ == "__main__".  
- Структурировали проект PersonalShop для дальнейшего расширения функционала.
